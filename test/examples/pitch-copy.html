<!doctype html>
<html lang="en">
    <head>
        <link href="../../dist/maplibre-gl.css" rel="stylesheet" />
        <style>
            html,
            body,
            #app,
            #map {
                margin: 0;
                width: 100vw;
                height: 100vh;
            }

            .maplibregl-control-container {
                display: none;
            }

            #change-zoom {
                position: absolute;
                top: 1rem;
                left: 1rem;
                z-index: 100;
            }

            #current-zoom {
                position: absolute;
                z-index: 100;
                font-size: 0.8rem;
                background-color: white;
                padding: 0.25rem;
                bottom: 1rem;
                left: 1rem;
            }
        </style>
    </head>

    <body>
        <div id="app">
            <button id="change-pitch">Change Pitch</button>
            <div id="map"></div>
            <div id="current-pitch"></div>
        </div>
        <script type="module">
            import "../../dist/maplibre-gl-dev.js";

            const map = new maplibregl.Map({
                container: "map",
                style: {
                  "version": 8,
                  "name": "Simple Raster Style",
                  "sources": {
                    "google-roadmap": {
                      "type": "raster",
                      "tiles": [
                        "https://mt0.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
                        "https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
                        "https://mt2.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
                        "https://mt3.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"
                      ],
                      "tileSize": 256,
                      "attribution": "Â© Google"
                    },
                    "local-tiles": {
                      "type": "raster",
                      "url": "http://localhost:3001/m_4112106_nw_10_030_20220717_epsg3857_rgb8"
                    },
                    "bounding-box": {
                      "type": "geojson",
                      "data": {
                        "type": "Feature",
                        "properties": {},
                        "geometry": {
                          "type": "Polygon",
                          "coordinates": [[
                                [150.62799999999993, -34.188883737879635],
                                [151.64698193359368, -34.188883737879635],
                                [151.64698193359368, -33.63699999999999],
                                [150.62799999999993, -33.63699999999999],
                                [150.62799999999993, -34.188883737879635]
                            ]]
                        }
                      }
                    }
                  },
                  "layers": [
                    {
                      "id": "google-roadmap-layer",
                      "type": "raster",
                      "source": "google-roadmap",
                      "minzoom": 0,
                      "maxzoom": 22
                    },
                    {
                      "id": "local-tiles-layer",
                      "type": "raster",
                      "source": "local-tiles",
                      "paint": {
                        "raster-opacity": 0.9
                      }
                    },
                    {
                      "id": "bounding-box-fill",
                      "type": "fill",
                      "source": "bounding-box",
                      "paint": {
                        "fill-color": "#ff0000",
                        "fill-opacity": 0.1
                      }
                    },
                    {
                      "id": "bounding-box-outline",
                      "type": "line",
                      "source": "bounding-box",
                      "paint": {
                        "line-color": "#ff0000",
                        "line-width": 2
                      }
                    }
                  ]
                },
                center: [151.18068748043615, -33.96434511002358],
                zoom: 9,
                transformCameraUpdate: (t) => t,
            });

            const marker = new maplibregl.Marker({
                color: "#F00",
            })
                .setLngLat([151.2057, -33.8727])
                .addTo(map);

            map.on("render", (e) => {
                const minPitch = e.target.getMinPitch();
                const maxPitch = e.target.getMaxPitch();
                const pitch = e.target.getPitch();
                document.querySelector("#current-pitch").innerHTML =
                    `${minPitch} - ${maxPitch} (${pitch})`;
            });

            document
                .querySelector("#change-pitch")
                .addEventListener("click", () => {
                    const currentMinPitch = map.getMinPitch();
                    if (currentMinPitch === 50) {
                        map.setMinPitch(currentMinPitch === 50 ? 20 : 50);
                        map.setMaxPitch(currentMinPitch === 50 ? 40 : 70);
                    } else {
                        map.setMaxPitch(currentMinPitch === 50 ? 40 : 70);
                        map.setMinPitch(currentMinPitch === 50 ? 20 : 50);
                    }
                });
        </script>
    </body>
</html>
