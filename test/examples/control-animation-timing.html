<!DOCTYPE html>
<html lang="en">
<head>
    <title>Control animation timing</title>
    <meta property="og:description" content="Use the timeControl API to freeze, resume, and jump to specific moments during map animations." />
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='../../dist/maplibre-gl.css' />
    <script src='../../dist/maplibre-gl-dev.js'></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }
        .controls button {
            background: #3386c0;
            color: white;
            border: none;
            padding: 6px 10px;
            margin: 2px;
            cursor: pointer;
            border-radius: 3px;
        }
        .controls button:hover { background: #4ea0da; }
        .controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #info {
            margin-top: 8px;
            padding: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 11px;
        }
    </style>
</head>
<body>
<div id="map"></div>
<div class="controls">
    <div><strong>TimeControl API</strong></div>
    <div style="margin: 5px 0; font-size: 11px; color: #666;">Paris â†’ New York (10s)</div>
    <div>
        <button onclick="start()" id="start-btn">Start Animation</button>
    </div>
    <div style="margin-top: 5px;">
        <button onclick="jumpTo(1000)">Jump to 1s</button>
        <button onclick="jumpTo(2000)">Jump to 2s</button>
        <button onclick="jumpTo(10000)">Jump to 10s</button>
    </div>
    <div style="margin-top: 5px;">
        <button onclick="resume()">Resume</button>
    </div>
    <div id="info">Elapsed: <span id="time">0</span>ms | Frozen: <span id="frozen">false</span></div>
</div>

<script>
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://demotiles.maplibre.org/style.json',
        center: [2.3522, 48.8566],
        zoom: 5
    });

    let startTime;

    function animate() {
        map.flyTo({
            center: [-74.006, 40.7128],
            zoom: 10,
            duration: 10000
        });
        setTimeout(() => {
            map.flyTo({
                center: [2.3522, 48.8566],
                zoom: 5,
                duration: 10000
            });
            setTimeout(animate, 10000);
        }, 10000);
    }

    function jumpTo(ms) {
        map.stop();
        map.jumpTo({ center: [2.3522, 48.8566], zoom: 5 });

        if (maplibregl.isTimeFrozen()) maplibregl.restoreNow();

        startTime = maplibregl.now();
        map.flyTo({
            center: [-74.006, 40.7128],
            zoom: 10,
            duration: 10000
        });

        maplibregl.setNow(startTime + ms);
    }

    function start() {
        map.jumpTo({ center: [2.3522, 48.8566], zoom: 5 });
        if (maplibregl.isTimeFrozen()) maplibregl.restoreNow();
        startTime = maplibregl.now();
        animate();
        document.getElementById('start-btn').disabled = true;
    }

    function resume() {
        if (maplibregl.isTimeFrozen()) maplibregl.restoreNow();
        map.jumpTo({ center: [2.3522, 48.8566], zoom: 5 });
        startTime = maplibregl.now();
        animate();
    }

    // Update display
    setInterval(() => {
        if (startTime) {
            const elapsed = maplibregl.now() - startTime;
            document.getElementById('time').textContent = Math.round(elapsed);
        }
        document.getElementById('frozen').textContent = maplibregl.isTimeFrozen();
    }, 50);
</script>
</body>
</html>
