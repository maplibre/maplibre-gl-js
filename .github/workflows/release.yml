name: Release

permissions:
  id-token: write  # Required for trusted publishing
  contents: write
  attestations: write

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  release:
    uses: maplibre/reusable-workflows/.github/workflows/npm-publish.yml@main
    with:
      build-command: npm ci && npm run build-dist
      docs-output-dir: site
      docs-gh-pages-dir: docs

  upload_benchmarks:
    needs: release
    uses: ./.github/workflows/upload-benchmarks.yml
    with:
      ref: ${{ github.ref }}
